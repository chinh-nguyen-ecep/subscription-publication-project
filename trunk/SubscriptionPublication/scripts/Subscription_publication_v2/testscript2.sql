DELETE FROM control.spctl_subscription_publication_checkpoint WHERE subscription_key IN (SELECT subscription_key FROM control.spctl_pub_customer_subscription WHERE customer_key=1)


DELETE FROM control.spctl_pub_customer_subscription WHERE customer_key=1;

INSERT INTO control.spctl_pub_customer_subscription(subscription_name,subscription_desc,frequence,zip_before_transfer,customer_key)
VALUES ('Monthly Backup AIS To AWS','','MONTHLY',TRUE,1);

SELECT * FROM CONTROL.spctl_data_source_tables WHERE table_type='DLA' AND table_name LIKE '%weekly%' ORDER BY table_name;
UPDATE CONTROL.spctl_data_source_tables SET table_type='WLA' WHERE table_name= 'rtb.weekly_agg_exchanger_cost_analysis_v1'
SELECT 'INSERT INTO CONTROL.spctl_data_source_tables (table_type,table_name) VALUES (\'WLA\',\'' ||name||'\')' FROM unnest(string_to_array('adsops.weekly_agg_advance_digital,adsops.weekly_agg_flight_missing_vendor,adsops.weekly_agg_mcclatchy_off,adsops.weekly_agg_publisher_performance_national_engagement,adsops.weekly_agg_publisher_performance_national_non_engagement,adsops.weekly_agg_publisher_performance_remnant,adsops.weekly_agg_publisher_performance_vlmo_engagement,adsops.weekly_agg_publisher_performance_vlmo_exclusion,adsops.weekly_agg_publisher_performance_vlmo_non_engagement,adsops.weekly_new_booked,rtb.weekly_agg_exchanger_cost_analysis_v1',',')) as name 
WHERE name NOT IN (SELECT table_name FROM CONTROL.spctl_data_source_tables WHERE table_type='WLA');



SELECT 'INSERT INTO control.spctl_data_file_config(df_config_name,df_config_format,dt_desc,df_source_file,data_subject_id,export_module_id,data_source_table_id) VALUES (''' || table_name || ''',''csv'','''','''',11,1,' || data_source_table_id || ');'
FROM CONTROL.spctl_data_source_tables 
WHERE table_name IN (SELECT unnest(string_to_array('adm.ba_daily_flight,adm.ba_daily_flight_exception,adm.ba_daily_flight_min,adm.daily_agg_api_revenue_by_partner_v4,adm.daily_agg_network_revenue_by_publisher,adm.daily_agg_network_revenue_min,adm.daily_network_fct_request_beta,adnetwork.daily_am_performance,adnetwork.daily_cg_performance,adnetwork.daily_it_performance,adnetwork.daily_jt_performance,adnetwork.daily_mm_performance,adnetwork.daily_mx_performance,adnetwork.daily_sp_blue_performance,adnetwork.daily_sp_performance,adnetwork.daily_yp_no_performance,adnetwork.daily_yp_sb_performance,adsops.daily_agg_delivery_adnetwork_publisher_v3,adsops.daily_agg_delivery_advertiser_beta,adsops.daily_agg_delivery_publisher_property_v3,adsops.daily_agg_io_line_item_report_map_stag,adsops.daily_agg_local_zero_delivered_v1,adsops.daily_agg_low_rate,adsops.daily_agg_verve_ads_by_remnant,adsops.daily_infobright_counts,adstraffic.daily_ad_serving_stats,adstraffic.daily_ad_serving_stats_by_content_category,adstraffic.daily_adcel_stats,adstraffic.daily_attributed_request_stats,adstraffic.daily_attributed_request_stats_by_adunit,adstraffic.daily_event_stats,adstraffic.daily_event_stats_by_adnet,adstraffic.daily_event_stats_by_content_category,adstraffic.daily_event_stats_by_dma,adstraffic.daily_event_stats_by_flight,adstraffic.daily_filled_stats,adstraffic.daily_filled_stats_by_adunit,adstraffic.daily_filled_stats_by_content_category,adstraffic.daily_filled_stats_by_dma,adstraffic.daily_geo_quality,adstraffic.daily_olap_attributed_request_by_uis,adstraffic.daily_olap_event_by_portal,adstraffic.daily_olap_filled_by_portal,adstraffic.daily_olap_trxids_by_content_category,adstraffic.daily_olap_trxids_by_portal,adstraffic.daily_olap_unfilled_by_portal,adstraffic.daily_unfilled_stats,adstraffic.daily_unfilled_stats_by_adunit,adstraffic.daily_unfilled_stats_by_content_category,adstraffic.daily_unfilled_stats_by_dma,evttracker.daily_event_adcel_stats,evttracker.daily_event_adcel_stats_by_flight,evttracker.daily_event_by_distance,evttracker.daily_event_dma,evttracker.daily_event_dma_by_hour,evttracker.daily_event_download,evttracker.daily_event_location_by_distance,evttracker.daily_event_maps_olap,evttracker.daily_event_maps_olap_min,evttracker.daily_event_stats,evttracker.daily_event_stats_adnet,evttracker.daily_event_stats_by_hour,evttracker.daily_event_x_value,evttracker.daily_event_x_value_by_hour,evttracker.daily_event_x_value_report,rtb.daily_agg_delivery_publisher_property_flight,rtb.daily_agg_exchanger_cost_analysis_v1,vlmo_dw.daily_agg_demand_by_metro,vlmo_dw.daily_agg_demand_by_offer',','))) 
AND table_name NOT IN (SELECT df_config_name FROM control.spctl_data_file_config WHERE data_subject_id=9)
AND table_name LIKE '%vlmo%'


SELECT 'INSERT INTO control.spctl_pub_customer_article(subscription_key,df_config_id) VALUES (37,'||df_config_id||');' FROM control.spctl_data_file_config
WHERE df_config_name IN (SELECT unnest(string_to_array('adnetwork.monthly_adnetwork_summary,adnetwork.monthly_adnetwork_summary_by_date,adnetwork.monthly_am_performance,adnetwork.monthly_am_performance_by_date,adnetwork.monthly_cg_performance,adnetwork.monthly_cg_performance_by_date,adnetwork.monthly_it_performance,adnetwork.monthly_it_performance_by_date,adnetwork.monthly_jt_performance,adnetwork.monthly_jt_performance_by_date,adnetwork.monthly_mm_performance,adnetwork.monthly_mm_performance_by_date,adnetwork.monthly_mx_performance,adnetwork.monthly_mx_performance_by_date,adnetwork.monthly_sp_blue_performance,adnetwork.monthly_sp_blue_performance_by_date,adnetwork.monthly_yp_no_performance,adnetwork.monthly_yp_no_performance_by_date,adnetwork.monthly_yp_sb_performance,adnetwork.monthly_yp_sb_performance_by_date,adsops.monthly_agg_delivery_adnetwork_publisher_v3,adsops.monthly_agg_delivery_publisher_property_v3,adstraffic.monthly_ad_serving_stats,adstraffic.monthly_ad_serving_stats_by_content_category,adstraffic.monthly_ad_serving_stats_by_date,billing.ba_monthly_adnetwork_summary,billing.ba_monthly_adnetwork_summary_v1,billing.ba_monthly_am_performance,billing.ba_monthly_api_revenue_by_publisher,billing.ba_monthly_cg_performance,billing.ba_monthly_io_line_item_v2,billing.ba_monthly_it_performance,billing.ba_monthly_jt_performance,billing.ba_monthly_local_revenue_v5,billing.ba_monthly_mm_performance,billing.ba_monthly_mx_performance,billing.ba_monthly_national_revenue_v5,billing.ba_monthly_publisher_revenue_v5,billing.ba_monthly_sp_blue_performance,billing.ba_monthly_vlm_revenue_v5,billing.ba_monthly_vlm_revenue_v6,billing.ba_monthly_vlmo_publisher_share,billing.ba_monthly_vlmo_revenue,billing.ba_monthly_yp_no_performance,billing.ba_monthly_yp_sb_performance,rtb.monthly_agg_exchanger_cost_analysis_v1',',')))
ORDER BY df_config_name